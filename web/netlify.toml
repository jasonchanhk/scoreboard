[build]
  base = "web"
  command = "npm run build"
  publish = "dist"

[functions]
  node_bundler = "esbuild"

# Netlify Functions:
# - Regular Functions: netlify/functions/ (Node.js runtime)
#   - scoreboard-preview.mjs: Unified function that handles both HTML (meta tags) and OG images
#     - Returns HTML with meta tags when requested normally
#     - Returns PNG image when ?image=true query parameter is present

# Redirect www to non-www (must come first)
[[redirects]]
  from = "https://www.prettyscoreboard.com/*"
  to = "https://prettyscoreboard.com/:splat"
  status = 301
  force = true

[[redirects]]
  from = "http://www.prettyscoreboard.com/*"
  to = "https://prettyscoreboard.com/:splat"
  status = 301
  force = true

# Route homepage to prerender function for better SEO
# Function serves pre-rendered HTML for crawlers, normal SPA for browsers
# This must come BEFORE the catch-all redirect
[[redirects]]
  from = "/"
  to = "/.netlify/functions/homepage-prerender"
  status = 200
  force = false

# Route scoreboard URLs to the function for crawler detection
# Function serves HTML with meta tags for crawlers, redirects browsers to SPA
# This must come BEFORE the catch-all redirect
[[redirects]]
  from = "/scoreboard/:id/view"
  to = "/.netlify/functions/scoreboard-meta?id=:id"
  status = 200
  force = true

[[redirects]]
  from = "/scoreboard/:id"
  to = "/.netlify/functions/scoreboard-meta?id=:id"
  status = 200
  force = true

# All other routes go to SPA (this must come AFTER the scoreboard redirect)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
